# AWS에 EC2 인스턴스 생성하기

Amazon Elastic Compute Cloud(Amazon EC2)란 AWS에서 제공하는 클라우드 컴퓨팅 서비스 중 하나입니다. (...EC2 설명)

AWS 회원가입과 결제 수단 등록 이후 다음과 같이 진행합니다. 우선 EC2 인스턴스를 생성할 region(리전)을 선택합니다. 선택한 리전 이외의 AWS 리소스들은 보이지 않으니 만약 학습 진행 중에 생성한 AWS 리소스가 보이지 않는다면 현재 리전을 확인합니다.
![[resources/ch1/4/1.png]]

리전 선택 이후 검색창에 EC2를 검색해서 EC2 대시보드 페이지로 들어갑니다.
![[resources/ch1/4/2.png]]

EC2 대시보드 페이지에서 현재 사용 중인 리소스들을 확인할 수 있습니다. EC2 인스턴스를 새로 생성해 보겠습니다. 좌측 메뉴 탭에서 인스턴스 페이지로 이동합니다.
![[resources/ch1/4/3.png]]

인스턴스 페이지에서 현재 인스턴스들의 상태를 확인할 수 있습니다. 인스턴스 시작 버튼을 눌러 새로운 EC2 인스턴스를 생성합니다.
![[resources/ch1/4/4.png]]

생성할 EC2 인스턴스의 이름을 입력하고 사용할 운영체제와 CPU 아키텍처를 선택합니다. 예제에서는 AWS 가입 시 1년간 프리 티어로 제공하는 Ubuntu(우분투) 20.04 LTS 버전과 64비트(x86) 아키텍처를 사용합니다.
![[resources/ch1/4/5.png]]

![[resources/ch1/4/6.png]]

인스턴스 유형은 EC2 인스턴스가 사용할 컴퓨터 자원을 설정합니다. 운영체제와 마찬가지로 프리 티어로 제공하는 t2.micro를 선택합니다. 생성할 인스턴스에 접속할 수 있는 key를 생성합니다.
![[resources/ch1/4/7.png]]

키 페어 이름과 유형을 선택하고 생성 버튼을 클릭하면 EC2 접속에 사용할 key가 다운로드됩니다. 다운로드한 key 파일은 앞으로 EC2 인스턴스에 접속할 때 사용되니 잘 보관해둡니다.
![[resources/ch1/4/8.png]]

예제의 네트워크 설정은 기본 VPC를 사용해 진행하겠습니다. (...VPC 설명) 
기본 VPC에 적용할 새로운 보안 그룹을 생성합니다. 보안 그룹이란 네트워크의 방화벽 규칙이라고 생각하면 이해하기 편합니다. 예를 들어 우리가 생성할 EC2 인스턴스의 외부 접속을 오직 SSH(22번 포트)로 제한하고 싶다면 해당 보안 그룹에 오직 22번 포트의 접속만 허용하면 됩니다.
스토리지 구성은 EC2 인스턴스가 사용할 저장 장치를 설정합니다. 프리 티어로 최대 30GB의 범용 SSD를 제공합니다.
설정을 마치고 인스턴스 시작 버튼을 클릭하여 EC2 인스턴스를 생성합니다.
![[resources/ch1/4/9.png]]

![[resources/ch1/4/10.png]]

인스턴스를 생성하면 다음과 같이 생성한 인스턴스의 정보를 확인할 수 있습니다. 인스턴스 상태가 대기 중에서 실행 중으로 변경될 때까지 잠시 기다립니다.

![[resources/ch1/4/11_대기중.png]]

다음과 같이 인스턴스 상태가 실행 중으로 변경되면 인스턴스에 접속해 봅시다. 접속할 인스턴스를 선택 후 연결 버튼을 클릭합니다. 연결 페이지에서 EC2 인스턴스에 접속하는 방법과 로컬 PC에서 SSH로 접속하는 방법이 있습니다.
![[resources/ch1/4/11_실행중.png]]

다음 그림은 연결 페이지에서 EC2 인스턴스에 접속하는 방법입니다. (...접속 성공 사진 추가)
![[resources/ch1/4/12.png]]

다음 그림은 로컬 PC에서 SSH를 사용해 접속하는 방법입니다. 터미널에서 인스턴스 생성 시 다운로드한 key 파일이 있는 디렉토리로 이동합니다. 터미널에 접속 명령어를 복사해 EC2 인스턴스에 접속합니다. 
 (...접속 성공 사진 추가)
![[resources/ch1/4/12_1.png]]

축하합니다. 우리의 첫 클라우드 서버에 성공적으로 접속했습니다. 다만 현재 우리 인스턴스에 한 가지 문제가 있습니다. 우리가 할당받은 공개 IP는 고정 IP가 아닌 동적 IP입니다. 때문에 인스턴스를 중지하고 재실행하면 할당받은 IP가 변경됩니다. 이를 해결하기 위해서 AWS의 탄력적 IP라는 서비스를 이용합니다. 탄력적 IP를 생성해 우리 인스턴스에 연결해야 합니다. 탄력적 IP 페이지로 이동합니다..
![[resources/ch1/4/13.png]]

탄력적 IP 페이지에서 EC2에 연결할 탄력적 IP를 생성할 수 있습니다. 탄력적 IP 주소 할당 버튼을 클릭합니다.
![[resources/ch1/4/13_1.png]]

탄력적 IP를 할당할 리전을 선택합니다. EC2 인스턴스와 같은 리전을 선택하고 할당 버튼을 클릭합니다.
![[resources/ch1/4/14.png]]

성공적으로 탄력적 IP가 생성되었습니다.
![[resources/ch1/4/15.png]]

 이제 생성된 탄력적 IP를 EC2 인스턴스에 연결해야 합니다. 연결할 탄력적 IP를 선택하고 탄력적 IP 주소 연결 버튼을 클릭합니다.
![[resources/ch1/4/16.png]]

탄력적 IP 주소를 연결할 EC2 인스턴스와 프라이빗 IP 주소를 선택하고 연결 버튼을 클릭합니다.
![[resources/ch1/4/17.png]]

성공적으로 연결되면 연결된 인스턴스 ID 항목에 EC2 인스턴스를 확인할 수 있습니다. 연결된 인스턴스 ID를 클릭해서 인스턴스 정보 페이지로 이동합니다.
![[resources/ch1/4/17_1.png]]

퍼블릭 IP 주소가 탄력적 IP로 변경된 것을 확인할 수 있습니다. 인스턴스의 상세 정보를 확인하기 위해 인스턴스 ID를 클릭합니다.
![[resources/ch1/4/18.png]]

이 페이지에서 인스턴스의 상세 정보를 확인할 수 있습니다. 보안 탭을 클릭하여 현재 인스턴스에 적용된 규칙을 확인합니다. 우리가 처음 인스턴스를 생성할 때 22번 포트에서만 접속 가능하게 인바운드 규칙을 설정했기 때문에 다른 포트들은 차단되어 있는 상태입니다.(... 인바운드 아웃바운드 설명) 
예제에서 하나의 EC2 인스턴스에서 MQTT 브로커와 Web Application Server(WAS)를 실행시킬 것이므로 브로커와 WAS가 사용할 포트를 열어줘야 합니다. 인스턴스에 적용된 보안 그룹 ID를 클릭해서 해당 보안 그룹 페이지로 이동합니다.
![[resources/ch1/4/19.png]]

인바운드 규칙 편집 버튼을 클릭합니다.
![[resources/ch1/4/20.png]]

규칙 추가 버튼을 클릭하여 새 인바운드 규칙을 생성합니다. 앞으로 예제에서 MQTT 브로커는 1883번 포트, WAS는 3000번 포트를 사용할 예정이기 때문에 그림과 같이 인바운드 규칙을 추가하고 규칙 저장 버튼을 클릭합니다.
![[resources/ch1/4/21.png]]

축하합니다. 다음과 같이 규칙이 적용되었다면 클라우드 컴퓨터를 사용할 준비가 끝났습니다.
![[resources/ch1/4/22.png]]