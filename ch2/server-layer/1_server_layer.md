# Server Layer Design

[//]: # (
그림 수정 예정 
서버 계층 그림으로 변경
)
 
서버 계층은 아래 그림과 같이 사용자와 하드웨어 계층 사이에 존재하며 MQTT 브로커와 웹 애플리케이션 서버로 구성됩니다. 이번에도 예시로 매장의 온도 모니터링 시스템을 개발한다고 생각해봅시다. 

1. 웹 애플리케이션 서버는 게이트웨이가 발행할 MQTT 토픽을 구독합니다.
2. H/W 계층에서 게이트웨이가 온도 MQTT 토픽을 생성하여 payload에 온도를 담아  MQTT 브로커에게 주기적으로 발행합니다. 
3. MQTT 브로커는 해당 토픽을 구독중인 웹 애플리케이션 서버에게 MQTT 토픽을 전달합니다. 
4. 웹 애플리케이션 서버는 구독한 온도 토픽에서 게이트웨이의 고유 id를 식별하고 payload에 담긴 온도 데이터를 저장합니다.
5. 사용자 계층에서 온도 데이터를 요청하면 웹 애플리케이션 서버는 저장된 가장 최근의 온도 데이터를 사용자 계층에 전달해줍니다.